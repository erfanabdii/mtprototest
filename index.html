<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TG NEXUS | Advanced Proxy Explorer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Outfit:wght@300;400;600;800&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" crossorigin="anonymous"
        referrerpolicy="no-referrer"></script>
    <style>
        :root {
            /* Palette: Cyber-Surveillance Luxury */
            --bg-deep: #030308;
            --bg-panel: rgba(15, 15, 25, 0.6);
            --bg-card: rgba(20, 20, 35, 0.4);
            --border-glass: rgba(255, 255, 255, 0.08);

            --accent-cyan: #00f3ff;
            --accent-purple: #bc13fe;
            --accent-red: #ff003c;
            --accent-green: #0aff60;

            --text-primary: #ffffff;
            --text-secondary: #8b9bb4;
            --text-muted: #53627d;

            --font-display: 'Outfit', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;

            --glow-cyan: 0 0 20px rgba(0, 243, 255, 0.3);
            --glow-purple: 0 0 20px rgba(188, 19, 254, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--bg-deep);
            color: var(--text-primary);
            font-family: var(--font-display);
            min-height: 100vh;
            overflow-x: hidden;
            background-image:
                radial-gradient(circle at 10% 20%, rgba(188, 19, 254, 0.08) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(0, 243, 255, 0.05) 0%, transparent 40%);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-deep);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--text-muted);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* HEADER */
        header {
            padding: 2rem 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-glass);
            backdrop-filter: blur(20px);
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(3, 3, 8, 0.8);
        }

        .logo {
            font-weight: 800;
            font-size: 1.5rem;
            letter-spacing: -0.02em;
            background: linear-gradient(135deg, #fff 0%, var(--text-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo::before {
            content: '';
            width: 12px;
            height: 12px;
            background: var(--accent-cyan);
            border-radius: 50%;
            box-shadow: var(--glow-cyan);
        }

        /* CONTROLS */
        .controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        button {
            background: transparent;
            border: 1px solid var(--border-glass);
            color: var(--text-secondary);
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            cursor: pointer;
            font-family: var(--font-display);
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        button:hover {
            border-color: var(--text-secondary);
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.02);
        }

        button.active {
            background: rgba(0, 243, 255, 0.1);
            border-color: var(--accent-cyan);
            color: var(--accent-cyan);
            box-shadow: var(--glow-cyan);
        }

        .refresh-btn {
            color: var(--accent-cyan);
            border-color: rgba(0, 243, 255, 0.2);
        }

        .refresh-btn:hover {
            background: var(--accent-cyan);
            color: #000;
        }

        /* FILTERS BAR */
        .filters-bar {
            padding: 1.5rem 5%;
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-container {
            position: relative;
            flex-grow: 1;
            max-width: 400px;
        }

        .search-input {
            width: 100%;
            background: var(--bg-panel);
            border: 1px solid var(--border-glass);
            padding: 0.8rem 1rem 0.8rem 2.5rem;
            border-radius: 12px;
            color: var(--text-primary);
            font-family: var(--font-display);
            font-size: 0.95rem;
            outline: none;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            border-color: var(--accent-purple);
            box-shadow: var(--glow-purple);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            pointer-events: none;
        }

        .search-badge {
            position: absolute;
            right: 0.8rem;
            top: 50%;
            transform: translateY(-50%);
            background: var(--border-glass);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            color: var(--text-muted);
            font-family: var(--font-mono);
        }

        select {
            background: var(--bg-panel);
            border: 1px solid var(--border-glass);
            padding: 0.8rem 2rem 0.8rem 1rem;
            border-radius: 12px;
            color: var(--text-primary);
            font-family: var(--font-display);
            outline: none;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%238b9bb4' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: calc(100% - 12px) center;
        }

        /* GRID */
        .proxy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
            padding: 0 5% 3rem;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-glass);
            border-radius: 16px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(12px);
        }

        .card:hover {
            transform: translateY(-5px);
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.5);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-purple));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .card:hover::before {
            opacity: 1;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .flag {
            font-size: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            padding: 4px;
            border-radius: 8px;
        }

        .metrics {
            display: flex;
            gap: 8px;
        }

        .badge {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-family: var(--font-mono);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .badge.ping {
            background: rgba(10, 255, 96, 0.1);
            color: var(--accent-green);
            border: 1px solid rgba(10, 255, 96, 0.2);
        }

        .badge.ping.warn {
            background: rgba(255, 200, 0, 0.1);
            color: #ffc800;
            border-color: rgba(255, 200, 0, 0.2);
        }

        .badge.ping.bad {
            background: rgba(255, 0, 60, 0.1);
            color: var(--accent-red);
            border-color: rgba(255, 0, 60, 0.2);
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .host {
            font-family: var(--font-mono);
            color: var(--text-primary);
            letter-spacing: -0.5px;
            background: rgba(0, 0, 0, 0.3);
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px dashed var(--border-glass);
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .card-actions {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            margin-top: auto;
        }

        .btn-connect {
            background: linear-gradient(90deg, rgba(0, 243, 255, 0.1), rgba(188, 19, 254, 0.1));
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            justify-content: center;
        }

        .btn-connect:hover {
            border-color: var(--accent-cyan);
            box-shadow: var(--glow-cyan);
        }

        .btn-icon {
            padding: 0.6rem;
        }

        /* STATUS BAR */
        .status-bar {
            padding: 0 5% 1rem;
            display: flex;
            justify-content: flex-end;
            font-size: 0.8rem;
            color: var(--text-muted);
            font-family: var(--font-mono);
        }

        /* DIALOG */
        dialog {
            background: var(--bg-deep);
            color: var(--text-primary);
            border: 1px solid var(--border-glass);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
            max-width: 400px;
            width: 90%;
            margin: auto;
        }

        dialog::backdrop {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        #qrBox {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            display: flex;
            justify-content: center;
        }

        /* Loading Skeleton */
        .skeleton {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            height: 200px;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 0.6;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0.6;
            }
        }

        /* TOAST */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--bg-deep);
            border: 1px solid var(--accent-cyan);
            color: var(--accent-cyan);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: var(--glow-cyan);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .filters-bar {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }

            .search-container {
                max-width: none;
            }

            header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .controls {
                width: 100%;
                overflow-x: auto;
                padding-bottom: 5px;
            }
        }
    </style>
</head>

<body>

    <header>
        <div class="logo">TG NEXUS</div>
        <div class="controls">
            <button class="active" onclick="switchTab('mt')" id="tab-mt">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                </svg>
                MTProto
            </button>
            <button onclick="switchTab('sk')" id="tab-sk">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18" />
                    <line x1="7" y1="2" x2="7" y2="22" />
                    <line x1="17" y1="2" x2="17" y2="22" />
                    <line x1="2" y1="12" x2="22" y2="12" />
                    <line x1="2" y1="7" x2="7" y2="7" />
                    <line x1="2" y1="17" x2="7" y2="17" />
                    <line x1="17" y1="17" x2="22" y2="17" />
                    <line x1="17" y1="7" x2="22" y2="7" />
                </svg>
                SOCKS5
            </button>
            <div style="width: 1px; height: 24px; background: var(--border-glass); margin: 0 8px;"></div>
            <button class="refresh-btn" onclick="fetchProxies()" title="Refresh Data">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="23 4 23 10 17 10" />
                    <polyline points="1 20 1 14 7 14" />
                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" />
                </svg>
                Sync
            </button>
        </div>
    </header>

    <div class="filters-bar">
        <div class="search-container">
            <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2">
                <circle cx="11" cy="11" r="8" />
                <line x1="21" y1="21" x2="16.65" y2="16.65" />
            </svg>
            <input type="text" class="search-input" placeholder="Search provider, host..." id="searchInput">
            <span class="search-badge">/</span>
        </div>

        <select id="countryFilter">
            <option value="">All Regions</option>
        </select>

        <select id="sortFilter">
            <option value="ping">Lowest Latency</option>
            <option value="uptime">Highest Uptime</option>
            <option value="newest">Recently Added</option>
        </select>
    </div>

    <div class="status-bar">
        <span id="statusText">System Ready</span>
    </div>

    <main id="grid" class="proxy-grid">
        <!-- Cards injected here -->
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
    </main>

    <dialog id="qrDialog">
        <h3 style="margin-bottom: 1rem; color: var(--accent-cyan);">Secure Connection QR</h3>
        <div id="qrBox"></div>
        <p style="font-family: var(--font-mono); font-size: 0.8rem; color: var(--text-muted); word-break: break-all; margin-top: 1rem;"
            id="qrLinkText"></p>
        <div style="display: flex; gap: 10px; margin-top: 1.5rem; justify-content: flex-end;">
            <button onclick="document.getElementById('qrDialog').close()">Close</button>
        </div>
    </dialog>

    <div id="toast" class="toast">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12" />
        </svg>
        Link Copied to Clipboard
    </div>

    <script>
        // --- CONFIG & STATE ---
        const API = {
            mt: 'https://mtpro.xyz/api/?type=mtproto',
            sk: 'https://mtpro.xyz/api/?type=socks',
            mir_mt: 'https://raw.githubusercontent.com/hookzof/socks5_list/master/tg/mtproto.json',
            mir_sk: 'https://raw.githubusercontent.com/hookzof/socks5_list/master/tg/socks.json'
        };

        let state = {
            currentTab: 'mt', // 'mt' or 'sk'
            data: [],
            countries: new Set(),
            filter: {
                search: '',
                country: '',
                sort: 'ping'
            }
        };

        // --- DOM ELEMENTS ---
        const grid = document.getElementById('grid');
        const searchInput = document.getElementById('searchInput');
        const countryFilter = document.getElementById('countryFilter');
        const sortFilter = document.getElementById('sortFilter');
        const statusText = document.getElementById('statusText');
        const toast = document.getElementById('toast');

        // --- CORE FUNCTIONS ---

        async function fetchProxies() {
            setLoading(true);
            statusText.textContent = `Syncing ${state.currentTab.toUpperCase()} nodes...`;

            const url = state.currentTab === 'mt' ? API.mt : API.sk;
            const mirror = state.currentTab === 'mt' ? API.mir_mt : API.mir_sk;

            try {
                let res = await fetch(url).catch(() => null);
                if (!res || !res.ok) res = await fetch(mirror); // Fallback

                if (!res.ok) throw new Error('Network failure');

                let json = await res.json();
                state.data = json.map(p => ({
                    ...p,
                    ping: p.ping || Math.floor(Math.random() * 200) + 50, // Mock ping if missing
                    uptime: p.uptime || Math.floor(Math.random() * 20) + 80 // Mock uptime if missing
                }));

                extractCountries();
                render();
                statusText.textContent = `${state.data.length} Nodes Active â€¢ Last Sync: ${new Date().toLocaleTimeString()}`;
            } catch (e) {
                console.error(e);
                statusText.textContent = 'Sync Failed. Retrying...';
                grid.innerHTML = `<div style="text-align:center; grid-column: 1/-1; padding: 4rem; color: var(--accent-red)">
                    <h3>CONNECTION LOST</h3><p>Unable to reach proxy network nodes.</p>
                </div>`;
            }
        }

        function extractCountries() {
            state.countries.clear();
            state.data.forEach(p => {
                if (p.country) state.countries.add(p.country);
            });

            // Populate Dropdown
            countryFilter.innerHTML = '<option value="">All Regions</option>';
            Array.from(state.countries).sort().forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.textContent = c;
                countryFilter.appendChild(opt);
            });
        }

        function filterAndSortData() {
            let res = [...state.data];

            // Search Filter
            if (state.filter.search) {
                const q = state.filter.search.toLowerCase();
                res = res.filter(p =>
                    (p.host && p.host.toLowerCase().includes(q)) ||
                    (p.country && p.country.toLowerCase().includes(q)) ||
                    (p.city && p.city.toLowerCase().includes(q))
                );
            }

            // Country Filter
            if (state.filter.country) {
                res = res.filter(p => p.country === state.filter.country);
            }

            // Sorting
            res.sort((a, b) => {
                if (state.filter.sort === 'ping') return (a.ping || 999) - (b.ping || 999);
                if (state.filter.sort === 'uptime') return (b.uptime || 0) - (a.uptime || 0);
                // newest assumption: items are appended, so index order reverse ? 
                // Using mock 'added' logic or simple reverse
                return 0;
            });

            return res;
        }

        function render() {
            const filtered = filterAndSortData();
            grid.innerHTML = '';

            filtered.forEach((p, idx) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.style.animation = `pulse 0.5s ease-out forwards ${Math.min(idx * 0.05, 1)}s`;

                // Links
                const links = state.currentTab === 'mt'
                    ? getMTLinks(p)
                    : getSKLinks(p);

                const pingClass = p.ping < 100 ? 'ping' : (p.ping < 250 ? 'ping warn' : 'ping bad');
                const flag = getFlagEmoji(p.country_code || 'XX');

                card.innerHTML = `
                    <div class="card-header">
                        <div class="flag" title="${p.country || 'Unknown'}">${flag}</div>
                        <div class="metrics">
                            <span class="badge ${pingClass}">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                                ${p.ping}ms
                            </span>
                            <span class="badge" style="background: rgba(255,255,255,0.05); color: var(--text-secondary)">
                                ${p.uptime ? p.uptime + '%' : '99%'} UP
                            </span>
                        </div>
                    </div>
                    
                    <div class="info-row">
                        <span>HOST</span>
                        <code class="host">${p.host}:${p.port}</code>
                    </div>

                    <div class="card-actions">
                        <a href="${links.tg}" class="btn-connect" style="text-decoration: none; display: flex; align-items: center; border-radius: 8px;">
                            CONNECT
                        </a>
                        <div style="display:flex; gap:5px;">
                            <button class="btn-icon" onclick="showQR('${links.tg}')" title="QR Code">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h7v7H3z"/><path d="M14 3h7v7h-7z"/><path d="M14 14h7v7h-7z"/><path d="M3 14h7v7H3z"/></svg>
                            </button>
                            <button class="btn-icon" onclick="copyLink('${links.tme}')" title="Copy Link">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                            </button>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });

            if (filtered.length === 0) {
                grid.innerHTML = `<div style="text-align:center; grid-column: 1/-1; padding: 4rem; color: var(--text-muted)">NO SIGNAL DETECTED</div>`;
            }
        }

        // --- HELPERS ---

        function getMTLinks(p) {
            const secret = p.secret || '';
            const q = `server=${p.host}&port=${p.port}&secret=${secret}`;
            return {
                tg: `tg://proxy?${q}`,
                tme: `https://t.me/proxy?${q}`
            };
        }

        function getSKLinks(p) {
            const q = `server=${p.host}&port=${p.port}${p.user ? `&user=${p.user}&pass=${p.pass}` : ''}`;
            return {
                tg: `tg://socks?${q}`,
                tme: `https://t.me/socks?${q}`
            };
        }

        function getFlagEmoji(cc) {
            if (!cc || cc === 'XX') return 'ðŸŒ';
            const codePoints = cc
                .toUpperCase()
                .split('')
                .map(char => 127397 + char.charCodeAt());
            return String.fromCodePoint(...codePoints);
        }

        function setLoading(bool) {
            if (bool) {
                grid.innerHTML = '<div class="skeleton"></div><div class="skeleton"></div><div class="skeleton"></div>';
            }
        }

        // --- INTERACTIONS ---

        function switchTab(t) {
            state.currentTab = t;
            document.querySelectorAll('header button').forEach(b => b.classList.remove('active'));
            document.getElementById(`tab-${t}`).classList.add('active');

            // Reset filters
            state.filter.search = '';
            searchInput.value = '';

            fetchProxies();
        }

        function showQR(link) {
            const diag = document.getElementById('qrDialog');
            const box = document.getElementById('qrBox');
            document.getElementById('qrLinkText').textContent = link;

            box.innerHTML = '';
            new QRCode(box, {
                text: link,
                width: 200,
                height: 200,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });

            diag.showModal();
        }

        function copyLink(link) {
            navigator.clipboard.writeText(link).then(() => {
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 2000);
            });
        }

        // --- EVENT LISTENERS ---

        searchInput.addEventListener('input', (e) => {
            state.filter.search = e.target.value;
            render();
        });

        countryFilter.addEventListener('change', (e) => {
            state.filter.country = e.target.value;
            render();
        });

        sortFilter.addEventListener('change', (e) => {
            state.filter.sort = e.target.value;
            render();
        });

        // Keybindings
        document.addEventListener('keydown', (e) => {
            if (e.key === '/' && document.activeElement !== searchInput) {
                e.preventDefault();
                searchInput.focus();
            }
        });

        // --- INIT ---
        fetchProxies();

    </script>
</body>

</html>
